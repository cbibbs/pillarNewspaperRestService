var Datastore = require("nedb");
var spromise  = require("spromise");

var ready = spromise.defer();
var db = {};

db.newspapers = new Datastore({
  filename: "storage/newspapers.db",
  autoload: true,
  onload: function(err) {
    if ( err ) {
      ready.reject(err);
    }
    else {
      ready.resolve(db);
    }
  }
});

db.newspapers.ensureIndex({fieldName: 'newspaperName', unique:true}, function(err) {});
db.newspapers.loadDatabase();
db.newspapers.ready = ready.promise;
module.exports = db.newspapers;
